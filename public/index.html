
<!DOCTYPE html>
<html lang="nl">
<head>
	<meta charset="UTF-8">
	<title>Login TrackerMobile</title>
	<style>
		body { font-family: 'Inter', Arial, sans-serif; background: #181a20; color: #e0e0e0; margin: 0; }
		.login-box { background: #23263a; padding: 40px 32px; margin: 80px auto; width: 340px; border-radius: 16px; box-shadow: 0 4px 24px #0008; border: 1px solid #2c2f3c; animation: fadeIn 0.7s; display: flex; flex-direction: column; align-items: center; }
		h2 { text-align: center; color: #fff; text-shadow: 0 2px 8px #0006; font-size: 2em; margin-bottom: 18px; }
		input[type=text], input[type=password], input[type=number] { width: 100%; padding: 12px; margin: 10px 0 20px; border: 1px solid #444; border-radius: 8px; background: #181a20; color: #e0e0e0; font-size: 1em; transition: border 0.2s; }
		input:focus { border: 1.5px solid #1976d2; background: #23263a; }
		button { width: 100%; padding: 12px; background: linear-gradient(90deg,#1976d2,#0d47a1); color: #fff; border: none; border-radius: 8px; font-size: 1.1em; font-weight: bold; box-shadow: 0 2px 12px #0004; transition: background 0.2s, transform 0.2s; }
		button:hover { filter: brightness(1.15); transform: translateY(-2px); }
		.error { color: #d32f2f; text-align: center; margin-bottom: 12px; font-weight: bold; font-size: 1em; }
		.success { color: #388e3c; text-align: center; margin-bottom: 12px; font-weight: bold; font-size: 1em; }
		@media (max-width: 500px) { .login-box { width: 98vw; padding: 24px 8px; margin: 30px auto; } }
		@keyframes fadeIn { from { opacity: 0; transform: translateY(30px); } to { opacity: 1; transform: translateY(0); } }
	</style>
</head>
<body>
	   <div class="login-box" id="loginBox">
		   <h2>Login</h2>
		   <form id="loginForm" style="width:100%;display:flex;flex-direction:column;align-items:center;">
			   <input type="text" id="username" placeholder="Gebruikersnaam" required autofocus style="max-width:260px;">
			   <input type="password" id="password" placeholder="Wachtwoord" required style="max-width:260px;">
			   <div class="error" id="errorMsg" style="max-width:260px;"></div>
			   <button type="submit" style="max-width:260px;">Inloggen</button>
		   </form>
	   </div>
	   <div class="login-box" id="logoutBox" style="display:none;flex-direction:column;align-items:center;">
		   <h2>Welkom!</h2>
		   <form id="pairForm" style="width:100%;display:flex;flex-direction:column;align-items:center;">
			   <input type="text" id="pairCode" placeholder="Pair code (6 cijfers)" maxlength="6" style="max-width:180px;">
			   <button type="submit" style="max-width:180px;">Koppel toestel</button>
			   <div class="success" id="pairSuccess" style="max-width:180px;"></div>
			   <div class="error" id="pairError" style="max-width:180px;"></div>
		   </form>
		   <input type="text" id="socketUrl" placeholder="Socket.io server URL" value="ws://localhost:4000" style="max-width:260px;margin-top:12px;">
		   <button id="setSocketUrlBtn" style="max-width:260px;margin-top:6px;">Gebruik deze server</button>
		   <button id="logoutBtn" style="max-width:260px;margin-top:18px;">Uitloggen</button>
		   <div id="connectionStatus" style="margin-top:12px;font-size:0.95em;"></div>
	   </div>
	   <script src="https://cdn.socket.io/4.7.4/socket.io.min.js"></script>
	   <script>
	   // Cookie helpers
	   function setCookie(name, value, days) {
		   let expires = "";
		   if (days) {
			   const date = new Date();
			   date.setTime(date.getTime() + (days*24*60*60*1000));
			   expires = "; expires=" + date.toUTCString();
		   }
		   document.cookie = name + "=" + (value || "")  + expires + "; path=/";
	   }
	   function getCookie(name) {
		   const nameEQ = name + "=";
		   const ca = document.cookie.split(';');
		   for(let i=0;i < ca.length;i++) {
			   let c = ca[i];
			   while (c.charAt(0)==' ') c = c.substring(1,c.length);
			   if (c.indexOf(nameEQ) == 0) return c.substring(nameEQ.length,c.length);
		   }
		   return null;
	   }
	   function eraseCookie(name) {
		   document.cookie = name+'=; Max-Age=-99999999; path=/';
	   }

	   // UI logic
	   function showLogin() {
		   document.getElementById('loginBox').style.display = 'flex';
		   document.getElementById('logoutBox').style.display = 'none';
	   }
	   function showLogout() {
		   document.getElementById('loginBox').style.display = 'none';
		   document.getElementById('logoutBox').style.display = 'flex';
	   }

	   // On page load, check login state
	   window.onload = function() {
		   if (getCookie('loggedIn') === 'true') {
			   showLogout();
			   checkConnection();
		   } else {
			   showLogin();
		   }
	   };

	   // Login form handler
	   document.getElementById('loginForm').onsubmit = function(e) {
		   e.preventDefault();
		   const username = document.getElementById('username').value;
		   const password = document.getElementById('password').value;
		   // Simpele check, vervang dit met echte authenticatie!
		   if (username && password) {
			   setCookie('loggedIn', 'true', 7); // 7 dagen ingelogd
			   document.getElementById('errorMsg').textContent = '';
			   showLogout();
			   checkConnection();
		   } else {
			   document.getElementById('errorMsg').textContent = 'Ongeldige gegevens';
		   }
	   };

	   // Logout button handler
	   document.getElementById('logoutBtn').onclick = function() {
		   eraseCookie('loggedIn');
		   showLogin();
	   };

	   // Device pairing logic
	   document.getElementById('pairForm').onsubmit = async function(e) {
		   e.preventDefault();
		   const code = document.getElementById('pairCode').value;
		   document.getElementById('pairSuccess').textContent = '';
		   document.getElementById('pairError').textContent = '';
		   if (!code || code.length !== 6) {
			   document.getElementById('pairError').textContent = 'Voer een geldige 6-cijferige code in.';
			   return;
		   }
		   try {
			   const res = await fetch('/api/pair_device', {
				   method: 'POST',
				   headers: { 'Content-Type': 'application/json' },
				   body: JSON.stringify({ code })
			   });
			   const data = await res.json();
			   if (data.success) {
				   document.getElementById('pairSuccess').textContent = 'Toestel gekoppeld!';
				   joinDeviceRoom(code);
			   } else {
				   document.getElementById('pairError').textContent = data.error || 'Koppeling mislukt.';
			   }
		   } catch (err) {
			   document.getElementById('pairError').textContent = 'Serverfout: ' + err.message;
		   }
	   };

	   // Socket.io connection
	   let socket = null;
	   let socketServerUrl = document.getElementById('socketUrl').value;

	   document.getElementById('setSocketUrlBtn').onclick = function() {
		   socketServerUrl = document.getElementById('socketUrl').value;
		   document.getElementById('connectionStatus').textContent = 'Socket.io server ingesteld: ' + socketServerUrl;
	   };

	   function joinDeviceRoom(code) {
		   if (!window.io) return;
		   if (socket) socket.disconnect();
		   try {
			   socket = io(socketServerUrl, { transports: ['websocket'] });
			   socket.on('connect', () => {
				   document.getElementById('connectionStatus').textContent = 'Verbonden met toestel (' + code + ')';
				   socket.emit('join-room', code);
			   });
			   socket.on('disconnect', () => {
				   document.getElementById('connectionStatus').textContent = 'Verbinding verbroken.';
			   });
			   socket.on('connect_error', (err) => {
				   document.getElementById('connectionStatus').textContent = 'Socket.io fout: ' + err.message;
			   });
			   socket.on('user-joined', (id) => {
				   document.getElementById('connectionStatus').textContent = 'Toestel verbonden: ' + id;
			   });
			   // Voeg hier extra event handlers toe voor live data/scherm
		   } catch (err) {
			   document.getElementById('connectionStatus').textContent = 'Socket.io fout: ' + err.message;
		   }
	   }

	   // Check backend connection
	   async function checkConnection() {
		   try {
			   const res = await fetch('/api/check_connection');
			   const data = await res.json();
			   if (data.connected) {
				   document.getElementById('connectionStatus').textContent = 'Backend verbinding OK.';
			   } else {
				   document.getElementById('connectionStatus').textContent = 'Backend niet bereikbaar.';
			   }
		   } catch (err) {
			   document.getElementById('connectionStatus').textContent = 'Backend niet bereikbaar.';
		   }
	   }
	   </script>

